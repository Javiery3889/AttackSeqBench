{
    "triplets": [
        {
            "Subject": "Comfoo",
            "SubjectType": "Malware",
            "Relation": "have",
            "Object": "network traffic",
            "ObjectType": "network traffic",
            "tactic": "Command and Control",
            "technique": [
                "T1071-Application Layer Protocol"
            ],
            "id": 1
        },
        {
            "Subject": "Comfoo",
            "SubjectType": "Malware",
            "Relation": "use",
            "Object": "HTTP requests and responses",
            "ObjectType": "network traffic",
            "tactic": "Command and Control",
            "technique": [
                "T1071-Application Layer Protocol"
            ],
            "id": 2
        },
        {
            "Subject": "Payloads",
            "SubjectType": "artifacts",
            "Relation": "encrypt-by",
            "Object": "10-byte static XOR key",
            "ObjectType": "encryption-key",
            "tactic": "Command and Control",
            "technique": [
                "T1573-Encrypted Channel"
            ],
            "id": 3
        },
        {
            "Subject": "Initial login data",
            "SubjectType": "artifacts",
            "Relation": "encrypt-by",
            "Object": "dynamic key",
            "ObjectType": "encryption-key",
            "tactic": "Command and Control",
            "technique": [
                "T1573-Encrypted Channel"
            ],
            "id": 4
        },
        {
            "Subject": "Comfoo C2 server",
            "SubjectType": "infrastructure",
            "Relation": "host",
            "Object": "rendezvous-type traffic relay program",
            "ObjectType": "software",
            "tactic": "Command and Control",
            "technique": [
                "T1071-Application Layer Protocol",
                "T1090-Proxy"
            ],
            "id": 5
        },
        {
            "Subject": "Comfoo relay server",
            "SubjectType": "infrastructure",
            "Relation": "listen-on",
            "Object": "TCP ports",
            "ObjectType": "network traffic",
            "tactic": "Command and Control",
            "technique": [
                "T1071-Application Layer Protocol",
                "T1090-Proxy"
            ],
            "id": 6
        },
        {
            "Subject": "First port",
            "SubjectType": "network trafic",
            "Relation": "act-as",
            "Object": "control",
            "ObjectType": "function",
            "tactic": "Command and Control",
            "technique": [
                "T1071-Application Layer Protocol",
                "T1090-Proxy"
            ],
            "id": 7
        },
        {
            "Subject": "Second port",
            "SubjectType": "network trafic",
            "Relation": "act-as",
            "Object": "admin relay port",
            "ObjectType": "function",
            "tactic": "Command and Control",
            "technique": [
                "T1071-Application Layer Protocol",
                "T1090-Proxy"
            ],
            "id": 8
        },
        {
            "Subject": "Third port",
            "SubjectType": "network trafic",
            "Relation": "act-as",
            "Object": "victim relay port",
            "ObjectType": "function",
            "tactic": "Command and Control",
            "technique": [
                "T1071-Application Layer Protocol",
                "T1090-Proxy"
            ],
            "id": 9
        },
        {
            "Subject": "Comfoo",
            "SubjectType": "Malware",
            "Relation": "replace",
            "Object": "DLL path",
            "ObjectType": "file",
            "tactic": "Execution",
            "technique": [
                "T1569-System Services"
            ],
            "id": 10
        },
        {
            "Subject": "Comfoo",
            "SubjectType": "Malware",
            "Relation": "start",
            "Object": "ipnat system service",
            "ObjectType": "process",
            "tactic": "Execution",
            "technique": [
                "T1569-System Services"
            ],
            "id": 11
        },
        {
            "Subject": "Comfoo",
            "SubjectType": "Malware",
            "Relation": "replace",
            "Object": "DLL path",
            "ObjectType": "directory",
            "tactic": "Persistence",
            "technique": [
                "T1574-Hijack Execution Flow"
            ],
            "id": 12
        },
        {
            "Subject": "Comfoo",
            "SubjectType": "Malware",
            "Relation": "delivered with",
            "Object": "rootkit",
            "ObjectType": "tool",
            "tactic": "Persistence",
            "technique": [
                "Others"
            ],
            "id": 13
        },
        {
            "Subject": "Comfoo",
            "SubjectType": "Malware",
            "Relation": "start",
            "Object": "ipnat system service",
            "ObjectType": "process",
            "tactic": "Persistence",
            "technique": [
                "T1543-Create or Modify System Process"
            ],
            "id": 14
        },
        {
            "Subject": "Comfoo RAT",
            "SubjectType": "Malware",
            "Relation": "have",
            "Object": "System/network information gathering",
            "ObjectType": "Tactic",
            "tactic": "Collection",
            "technique": [
                "Others"
            ],
            "id": 15
        },
        {
            "Subject": "Comfoo RAT",
            "SubjectType": "Malware",
            "Relation": "have",
            "Object": "keystroke logging",
            "ObjectType": "Technique",
            "tactic": "Collection",
            "technique": [
                "T1056-Input Capture"
            ],
            "id": 16
        },
        {
            "Subject": "Comfoo RAT",
            "SubjectType": "Malware",
            "Relation": "have",
            "Object": "screenshots",
            "ObjectType": "Technique",
            "tactic": "Collection",
            "technique": [
                "T1113-Screen Capture"
            ],
            "id": 17
        },
        {
            "Subject": "Comfoo RAT",
            "SubjectType": "Malware",
            "Relation": "have",
            "Object": "file upload",
            "ObjectType": "Technique",
            "tactic": "Collection",
            "technique": [
                "Others"
            ],
            "id": 18
        },
        {
            "Subject": "Comfoo RAT",
            "SubjectType": "Malware",
            "Relation": "have",
            "Object": "file download",
            "ObjectType": "Technique",
            "tactic": "Collection",
            "technique": [
                "Others"
            ],
            "id": 19
        },
        {
            "Subject": "Comfoo RAT",
            "SubjectType": "Malware",
            "Relation": "have",
            "Object": "file execute",
            "ObjectType": "Technique",
            "tactic": "Collection",
            "technique": [
                "Others"
            ],
            "id": 20
        },
        {
            "Subject": "Comfoo RAT",
            "SubjectType": "Malware",
            "Relation": "have",
            "Object": "command shell",
            "ObjectType": "Tool",
            "tactic": "Collection",
            "technique": [
                "Others"
            ],
            "id": 21
        }
    ],
    "file_name": "Secrets_of_the_Comfoo_Masters",
    "tactic_label": true,
    "rewrite": {
        "Execution": "To maintain persistence on the system, Comfoo usually replaces the path to the DLL of an existing unused service rather than installing a new service. A new service is more likely to be noticed by system audits. Sometimes Comfoo is delivered with a rootkit that hides Comfoo's files on disk. Additionally, Comfoo starts the existing \"ipnat\" system service. This action causes remote inbound connections to the infected system to fail, blocking remote maintenance by the network administrator.",
        "Persistence": "To maintain persistence on the system, Comfoo usually replaces the path to the DLL of an existing unused service rather than installing a new service. A new service is more likely to be noticed by system audits. Sometimes Comfoo is delivered with a rootkit that hides Comfoo's files on disk. Additionally, Comfoo starts the existing \"ipnat\" system service. This action causes remote inbound connections to the infected system to fail, blocking remote maintenance by the network administrator.",
        "Collection": "The Comfoo RAT has the following features: System/network information gathering, keystroke logging, screenshots, file upload/download/execute, command shell.",
        "Command and Control": "Comfoo's network traffic is encrypted and encapsulated in HTTP requests and responses, although some variants skip the encapsulation step. Payloads are encrypted by a 10-byte static XOR key that is hard-coded inside the Comfoo binary. Initial login data from the infected system (MAC address, internal IP address, campaign tag, and version data) is passed in the request URI and is additionally encrypted by a dynamic key. The Comfoo C2 server turns out to be a rendezvous-type traffic relay program. This small binary can be deployed on rented or hacked Windows systems, where it passes traffic between Comfoo victims and the Comfoo master console operated by the threat actors. The Comfoo relay server listens on up to three TCP ports at a time. The first port acts as a control and typically listens on port 1688. It performs the following tasks: Enables/disables the other ports, accepts new relay port configuration (stored in rlycfg.dll), notifies master console that a new victim connection is available. The second port is the admin relay port, which typically listens on port 1689. It accepts connections from the master console to send commands to and receive data from victims' systems. The third port is the victim relay port, which listens on a configurable port number, usually port 80 or port 443. This port accepts connections from victims' systems to send data to and receive commands from the Comfoo administrator encapsulated in HTTP requests and responses. If there is no current connection between the victim and the Comfoo administrator, Comfoo logs the victim's connection and sends an idle response to the victim.",
        "Others": "The Dell SecureWorks Counter Threat Unit(TM) (CTU) research team has tracked a RAT known as \"Comfoo\" that has been in continuous development since at least 2006. This RAT has maintained a fairly low profile, even though it was used as part of the RSA breach in 2010, when its code was first analyzed. Antivirus firm Trend Micro briefly mentioned its use in a 2012 paper titled \"Luckycat Redux \u2014 Inside an APT Campaign with Multiple Targets in India and Japan.\" However, the disclosure of this trojan and some of its command and control (C2) infrastructure did not discourage its continued use by the threat actors responsible for it. Dell SecureWorks researchers have identified and classified more than 200 distinct malware families used by various APT groups. Some malware is specially configured off-the-shelf software, and some malware is customized source code of an existing RAT. However, most malware families are proprietary, developed by the APT groups as weapons to be deployed against a variety of targets. Accurate identification and classification of this malware by antivirus (AV) companies is sparse. Shared code, the use of common tools, co-infections, and a history of generic or incorrect classification by multiple names make the automated tracking of these tools by AV companies difficult. This inaccuracy can be detrimental when designing defenses based on specific threat indicators. Tracking APTs requires a dedicated malware intelligence effort. One way applied malware intelligence is used to discover new APT trojans is a recursive investigative method: Malware -> Infrastructure Touchpoints -> New Malware -> and so on. Cyber-espionage actors often cycle through different RATs over a period of years. The Dell SecureWorks Counter Threat Unit(TM) (CTU) research team has tracked a RAT known as \"Comfoo\" that has been in continuous development since at least 2006. This RAT has maintained a fairly low profile, even though it was used as part of the RSA breach in 2010, when its code was first analyzed. Antivirus firm Trend Micro briefly mentioned its use in a 2012 paper titled \"Luckycat Redux \u2014 Inside an APT Campaign with Multiple Targets in India and Japan.\" However, the disclosure of this trojan and some of its command and control (C2) infrastructure did not discourage its continued use by the threat actors responsible for it."
    },
    "technique_label": true
}