{
    "triplets": [
        {
            "Subject": "campaign",
            "SubjectType": "campaign",
            "Relation": "target",
            "Object": "organizations in Turkey, Pakistan, and Tajikistan",
            "ObjectType": "Location",
            "tactic": "Initial Access",
            "technique": [
                "T1190-Exploit Public-Facing Application"
            ],
            "id": 1
        },
        {
            "Subject": "campaign",
            "SubjectType": "campaign",
            "Relation": "use",
            "Object": "malicious delivery documents",
            "ObjectType": "artifact",
            "tactic": "Initial Access",
            "technique": [
                "T1190-Exploit Public-Facing Application"
            ],
            "id": 2
        },
        {
            "Subject": "malicious delivery documents",
            "SubjectType": "artifact",
            "Relation": "contain",
            "Object": "payload",
            "ObjectType": "Malware",
            "tactic": "Initial Access",
            "technique": [
                "T1190-Exploit Public-Facing Application"
            ],
            "id": 3
        },
        {
            "Subject": "payload",
            "SubjectType": "Malware",
            "Relation": "download",
            "Object": "from the internet",
            "ObjectType": "infrastructure",
            "tactic": "Initial Access",
            "technique": [
                "T1190-Exploit Public-Facing Application"
            ],
            "id": 4
        },
        {
            "Subject": "path to the VBS script",
            "SubjectType": "artifact",
            "Relation": "added to",
            "Object": "task scheduler",
            "ObjectType": "software",
            "tactic": "Persistence",
            "technique": [
                "T1053-Scheduled Task/Job"
            ],
            "id": 5
        },
        {
            "Subject": "campaigns",
            "SubjectType": "campaign",
            "Relation": "use",
            "Object": "obfuscation processes",
            "ObjectType": "Technique",
            "tactic": "Defense Evasion",
            "technique": [
                "T1027-Obfuscated Files or Information"
            ],
            "id": 6
        },
        {
            "Subject": "PowerShell script",
            "SubjectType": "tool",
            "Relation": "employ",
            "Object": "obfuscation",
            "ObjectType": "Technique",
            "tactic": "Defense Evasion",
            "technique": [
                "T1027-Obfuscated Files or Information"
            ],
            "id": 7
        },
        {
            "Subject": "scriptlet file",
            "SubjectType": "file",
            "Relation": "use",
            "Object": "publicly available code",
            "ObjectType": "tool",
            "tactic": "Defense Evasion",
            "technique": [
                "T1027-Obfuscated Files or Information"
            ],
            "id": 8
        },
        {
            "Subject": "inf file",
            "SubjectType": "file",
            "Relation": "use",
            "Object": "publicly available code",
            "ObjectType": "tool",
            "tactic": "Defense Evasion",
            "technique": [
                "T1027-Obfuscated Files or Information"
            ],
            "id": 9
        },
        {
            "Subject": "The backdoor function",
            "SubjectType": "Technique",
            "Relation": "collect",
            "Object": "machine information and screenshots",
            "ObjectType": "artifacts",
            "tactic": "Discovery",
            "technique": [
                "T1082-System Information Discovery",
                "T1010-Application Window Discovery"
            ],
            "id": 10
        },
        {
            "Subject": "This data",
            "SubjectType": "artifacts",
            "Relation": "send to",
            "Object": "a C&C server",
            "ObjectType": "infrastructure",
            "tactic": "Discovery",
            "technique": [
                "Others"
            ],
            "id": 11
        },
        {
            "Subject": "backdoor",
            "SubjectType": "Malware",
            "Relation": "communicate-with",
            "Object": "C&C server",
            "ObjectType": "infrastructure",
            "tactic": "Command and Control",
            "technique": [
                "T1573-Encrypted Channel"
            ],
            "id": 12
        },
        {
            "Subject": "backdoor",
            "SubjectType": "Malware",
            "Relation": "query",
            "Object": "api[.]ipify[.]org",
            "ObjectType": "domain-name",
            "tactic": "Command and Control",
            "technique": [
                "T1102-Web Service"
            ],
            "id": 13
        },
        {
            "Subject": "backdoor",
            "SubjectType": "Malware",
            "Relation": "send",
            "Object": "system information",
            "ObjectType": "artifacts",
            "tactic": "Command and Control",
            "technique": [
                "T1102-Web Service"
            ],
            "id": 14
        },
        {
            "Subject": "macros",
            "SubjectType": "artifacts",
            "Relation": "enable",
            "Object": "payload",
            "ObjectType": "Malware",
            "tactic": "Execution",
            "technique": [
                "T1204-User Execution"
            ],
            "id": 15
        },
        {
            "Subject": "payload",
            "SubjectType": "Malware",
            "Relation": "create",
            "Object": "files",
            "ObjectType": "file",
            "tactic": "Execution",
            "technique": [
                "T1204-User Execution"
            ],
            "id": 16
        },
        {
            "Subject": "VBS script",
            "SubjectType": "file",
            "Relation": "execute",
            "Object": "PowerShell script",
            "ObjectType": "file",
            "tactic": "Execution",
            "technique": [
                "T1059-Command and Scripting Interpreter"
            ],
            "id": 17
        },
        {
            "Subject": "VBS script",
            "SubjectType": "file",
            "Relation": "added-to",
            "Object": "task scheduler",
            "ObjectType": "tool",
            "tactic": "Execution",
            "technique": [
                "T1053-Scheduled Task/Job"
            ],
            "id": 18
        },
        {
            "Subject": "scriptlet file and inf file",
            "SubjectType": "file",
            "Relation": "use",
            "Object": "publicly available code",
            "ObjectType": "tool",
            "tactic": "Execution",
            "technique": [
                "Others"
            ],
            "id": 19
        },
        {
            "Subject": "PowerShell script",
            "SubjectType": "file",
            "Relation": "employs",
            "Object": "obfuscation",
            "ObjectType": "technique",
            "tactic": "Execution",
            "technique": [
                "Others"
            ],
            "id": 20
        },
        {
            "Subject": "backdoor function",
            "SubjectType": "tool",
            "Relation": "collects",
            "Object": "machine information",
            "ObjectType": "information",
            "tactic": "Execution",
            "technique": [
                "Others"
            ],
            "id": 21
        },
        {
            "Subject": "backdoor function",
            "SubjectType": "tool",
            "Relation": "sends",
            "Object": "data",
            "ObjectType": "information",
            "tactic": "Execution",
            "technique": [
                "Others"
            ],
            "id": 22
        },
        {
            "Subject": "backdoor function",
            "SubjectType": "tool",
            "Relation": "waits-for",
            "Object": "commands",
            "ObjectType": "information",
            "tactic": "Execution",
            "technique": [
                "Others"
            ],
            "id": 23
        },
        {
            "Subject": "backdoor function",
            "SubjectType": "tool",
            "Relation": "collect",
            "Object": "machine information",
            "ObjectType": "artifacts",
            "tactic": "Collection",
            "technique": [
                "T1113-Screen Capture",
                "T1074-Data Staged"
            ],
            "id": 24
        },
        {
            "Subject": "backdoor function",
            "SubjectType": "tool",
            "Relation": "take",
            "Object": "screenshots",
            "ObjectType": "artifacts",
            "tactic": "Collection",
            "technique": [
                "T1113-Screen Capture"
            ],
            "id": 25
        },
        {
            "Subject": "backdoor function",
            "SubjectType": "tool",
            "Relation": "send",
            "Object": "data",
            "ObjectType": "artifacts",
            "tactic": "Collection",
            "technique": [
                "T1074-Data Staged"
            ],
            "id": 26
        },
        {
            "Subject": "data",
            "SubjectType": "artifacts",
            "Relation": "beacon-to",
            "Object": "C&C server",
            "ObjectType": "infrastructure",
            "tactic": "Collection",
            "technique": [
                "T1074-Data Staged"
            ],
            "id": 27
        }
    ],
    "file_name": "MuddyWater_Middle_East_and_Central_Asia",
    "tactic_label": true,
    "rewrite": {
        "Initial Access": "We discovered a new campaign targeting organizations in Turkey, Pakistan, and Tajikistan that has similarities with an earlier campaign named MuddyWater. The campaign uses malicious delivery documents containing text and file names in the Tajik language, attempting to target individuals working for government organizations and telecommunication companies in Tajikistan. Each document uses social engineering to trick potential victims into enabling macros and activating the payload. Some payloads were embedded inside the document, while others were downloaded from the internet after the lure was clicked. There is also a separate lure with a program key generator written in Java that was bundled with a Java downloader. The actual payload is the same in both cases.",
        "Execution": "After enabling the macros and the payload executes, two files are created in the ProgramData directory placed in randomly-named directories. The purpose of the .VBS script is to execute the PowerShell script. The path to the VBS script is added to the task scheduler as a form of persistence. In other campaigns, two files are also dropped: a VBS script and a base64 encoded text file, which results in the PowerShell file after decoding. The latest change drops three files: an .sct scriptlet file, an .inf file, and a base64 encoded data file. The scriptlet file and inf file use publicly available code for bypassing AppLocker. The PowerShell script employs several layers of obfuscation and is divided into three parts: global variables like paths and encryption keys, functions related to encryption, and the backdoor function which collects machine information, takes screenshots, and sends this data to a C&C server while waiting for commands.",
        "Persistence": "The path to the VBS script is added to the task scheduler as a form of persistence.",
        "Defense Evasion": "The campaigns use similar obfuscation processes, and the internal variables after deobfuscation. A list of isDebugEnv is also present in both campaigns. The PowerShell script employs several layers of obfuscation. The scriptlet file and inf file use publicly available code for bypassing AppLocker.",
        "Discovery": "The backdoor function collects machine information and takes screenshots before sending this data to a C&C server.",
        "Collection": "The backdoor function collects machine information and takes screenshots before sending this data to a C&C server.",
        "Command and Control": "The communication with the C&C server is done via XML messages with supported ACTION commands: REGISTER, IMAGE, COMMAND, RESULT, and UPLOAD. The backdoor finds out the machine IP address by querying the internet service api[.]ipify[.]org, which returns the IP address of the currently infected machine. This IP address is then fed to another internet service called apinotes[.]com, which returns the location information of the given IP address. The backdoor then collects system information about the infected machine and sends this as part of the REGISTER message. The communication is encrypted using a simple RSA algorithm with very small keys.",
        "Others": "The attackers are actively monitoring the incoming connections to the C&C server. In one attempt, an improper request to the C&C server was met with a personalized message: \"Stop!!! I Kill You Researcher.\" This indicates that the attackers are monitoring what data is going to and from their C&C server. Another hidden message or a false flag is found in the PowerShell script, with error messages written in simplified Mandarin Chinese displayed if communication with C&C fails and the script is run from a command line. These messages may not reveal anything about the real attackers as malware writers sometimes embed false flags into their programs to confuse researchers."
    },
    "technique_label": true
}