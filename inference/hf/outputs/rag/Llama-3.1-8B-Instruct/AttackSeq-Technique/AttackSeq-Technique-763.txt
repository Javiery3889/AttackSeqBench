To answer this question, let's break it down step by step.

1. **Analyze the Question:** The question asks about the ATT&CK technique that UNC1151 used before gaining initial access through spear phishing campaigns. Specifically, it's asking about the technique used to understand details about victim webmail providers, government entities, and private businesses.

2. **Analyze the Related TTPs:** The related TTPs provided are:
   - Tactic: Reconnaissance, Technique: T1591-Gather Victim Org Information
   - Tactic: Initial Access, Technique: T1566-Phishing
   - Tactic: Initial Access, Technique: T1566.001-Spearphishing Attachment

   These TTPs indicate that UNC1151 used reconnaissance to gather information about their victims and then used phishing and spear phishing to gain initial access.

3. **Compare and Evaluate:**
   - **A: T1591.004-Identify Roles:** This technique is related to gathering information about the roles within an organization, which is not directly related to understanding details about victim webmail providers, government entities, and private businesses.
   - **B: T1566-Phishing:** This is the parent technique for both spear phishing and phishing. However, the question specifically asks about the technique used before gaining initial access through spear phishing, which suggests that the technique in question is more specific than just phishing.
   - **C: T1586.002-Email Accounts:** This technique is related to gathering information about email accounts, which is a part of understanding details about victim webmail providers, but it's not the most direct match for the question.
   - **D: T1590-Gather Victim Network Information:** This technique is related to gathering information about the victim's network, which is not directly related to understanding details about victim webmail providers, government entities, and private businesses.

   Based on the related TTPs, the most plausible sequence of events is that UNC1151 used reconnaissance to gather information about their victims (T1591-Gather Victim Org Information) before using spear phishing to gain initial access.

4. **Step-by-Step Reasoning and Final Answer:**
   - The question asks about the technique used before gaining initial access through spear phishing.
   - The related TTPs indicate that UNC1151 used reconnaissance to gather information about their victims.
   - The most direct match for the question is T1591-Gather Victim Org Information, which is a reconnaissance technique used to gather information about the victim's organization.

Final Answer: D: T1590-Gather Victim Network Information