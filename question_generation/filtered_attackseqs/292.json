{
    "triplets": [
        {
            "Subject": "Unit 42",
            "SubjectType": "CTI vender",
            "Relation": "reported",
            "Object": "targeted attack",
            "ObjectType": "campaign",
            "tactic": "Initial Access",
            "technique": [
                "T1566-Phishing"
            ],
            "id": 1
        },
        {
            "Subject": "DarkHydrus",
            "SubjectType": "threat-actor",
            "Relation": "use",
            "Object": "spear-phishing emails",
            "ObjectType": "Email Message",
            "tactic": "Initial Access",
            "technique": [
                "T1566-Phishing"
            ],
            "id": 2
        },
        {
            "Subject": "DarkHydrus",
            "SubjectType": "threat-actor",
            "Relation": "deliver",
            "Object": "malicious Excel Web Query files",
            "ObjectType": "file",
            "tactic": "Initial Access",
            "technique": [
                "T1566-Phishing"
            ],
            "id": 3
        },
        {
            "Subject": "PowerShell script",
            "SubjectType": "tool",
            "Relation": "host",
            "Object": "URL",
            "ObjectType": "url",
            "tactic": "Initial Access",
            "technique": [
                "T1566-Phishing"
            ],
            "id": 4
        },
        {
            "Subject": "PowerShell script",
            "SubjectType": "tool",
            "Relation": "named",
            "Object": "RogueRobin",
            "ObjectType": "Malware",
            "tactic": "Execution",
            "technique": [
                "T1059-Command and Scripting Interpreter"
            ],
            "id": 5
        },
        {
            "Subject": "RogueRobin",
            "SubjectType": "Malware",
            "Relation": "obfuscated",
            "Object": "Invoke-Obfuscation tool",
            "ObjectType": "tool",
            "tactic": "Execution",
            "technique": [
                "T1059-Command and Scripting Interpreter"
            ],
            "id": 6
        },
        {
            "Subject": "RogueRobin",
            "SubjectType": "Malware",
            "Relation": "check",
            "Object": "sandbox environments",
            "ObjectType": "infrastructure",
            "tactic": "Execution",
            "technique": [
                "T1059-Command and Scripting Interpreter"
            ],
            "id": 7
        },
        {
            "Subject": "RogueRobin",
            "SubjectType": "Malware",
            "Relation": "install",
            "Object": "itself",
            "ObjectType": "Malware",
            "tactic": "Execution",
            "technique": [
                "T1569-System Services"
            ],
            "id": 8
        },
        {
            "Subject": "RogueRobin",
            "SubjectType": "Malware",
            "Relation": "communicate with",
            "Object": "C2 servers",
            "ObjectType": "infrastructure",
            "tactic": "Execution",
            "technique": [
                "T1059-Command and Scripting Interpreter"
            ],
            "id": 9
        },
        {
            "Subject": "RogueRobin",
            "SubjectType": "Malware",
            "Relation": "create",
            "Object": "%APPDATA%\\OneDrive.bat",
            "ObjectType": "file",
            "tactic": "Persistence",
            "technique": [
                "T1547-Boot or Logon Autostart Execution"
            ],
            "id": 10
        },
        {
            "Subject": "RogueRobin",
            "SubjectType": "Malware",
            "Relation": "create",
            "Object": "%APPDATA%\\OneDrive.ps1",
            "ObjectType": "file",
            "tactic": "Persistence",
            "technique": [
                "T1547-Boot or Logon Autostart Execution"
            ],
            "id": 11
        },
        {
            "Subject": "RogueRobin",
            "SubjectType": "Malware",
            "Relation": "create",
            "Object": "Windows startup folder shortcut",
            "ObjectType": "file",
            "tactic": "Persistence",
            "technique": [
                "T1547-Boot or Logon Autostart Execution"
            ],
            "id": 12
        },
        {
            "Subject": "The payload",
            "SubjectType": "Malware",
            "Relation": "use",
            "Object": "sandbox detection techniques",
            "ObjectType": "technique",
            "tactic": "Defense Evasion",
            "technique": [
                "T1497-Virtualization/Sandbox Evasion"
            ],
            "id": 13
        },
        {
            "Subject": "The payload",
            "SubjectType": "Malware",
            "Relation": "obfuscate",
            "Object": "PowerShell script",
            "ObjectType": "file",
            "tactic": "Defense Evasion",
            "technique": [
                "T1027-Obfuscated Files or Information"
            ],
            "id": 14
        },
        {
            "Subject": "The payload",
            "SubjectType": "Malware",
            "Relation": "leverage",
            "Object": "user's consent in Excel",
            "ObjectType": "technique",
            "tactic": "Defense Evasion",
            "technique": [
                "T1553-Subvert Trust Controls"
            ],
            "id": 15
        },
        {
            "Subject": "The payload",
            "SubjectType": "Malware",
            "Relation": "execute",
            "Object": "command prompt application",
            "ObjectType": "software",
            "tactic": "Defense Evasion",
            "technique": [
                "T1553-Subvert Trust Controls"
            ],
            "id": 16
        },
        {
            "Subject": "RogueRobin payload",
            "SubjectType": "Malware",
            "Relation": "communicate-with",
            "Object": "C2 servers",
            "ObjectType": "infrastructure",
            "tactic": "Command and Control",
            "technique": [
                "T1132-Data Encoding"
            ],
            "id": 17
        },
        {
            "Subject": "RogueRobin payload",
            "SubjectType": "Malware",
            "Relation": "use",
            "Object": "custom DNS tunneling protocol",
            "ObjectType": "technique",
            "tactic": "Command and Control",
            "technique": [
                "T1572-Protocol Tunneling"
            ],
            "id": 18
        },
        {
            "Subject": "C2 domains",
            "SubjectType": "domain-name",
            "Relation": "spoof",
            "Object": "legitimate technology providers",
            "ObjectType": "identity",
            "tactic": "Command and Control",
            "technique": [
                "T1572-Protocol Tunneling"
            ],
            "id": 19
        },
        {
            "Subject": "C2 domains",
            "SubjectType": "domain-name",
            "Relation": "resolve-to",
            "Object": "IPs",
            "ObjectType": "ipv4-addr",
            "tactic": "Command and Control",
            "technique": [
                "T1572-Protocol Tunneling"
            ],
            "id": 20
        }
    ],
    "file_name": "New Threat Actor Group DarkHydrus Targets Middle East Government",
    "tactic_label": true,
    "rewrite": {
        "Initial Access": "In July 2018, Unit 42 reported a targeted attack against a Middle East government agency by a threat group named DarkHydrus. The attack involved spear-phishing emails with password-protected RAR archive attachments containing malicious Excel Web Query files (.iqy). The emails, sent between July 15 and 16, contained a message in Arabic with a password for the RAR archive. The .iqy file, once opened in Excel, would prompt the user to enable a data connection, allowing the download and execution of a PowerShell script hosted at a URL within the file.",
        "Execution": "The PowerShell script, named RogueRobin, was obfuscated using the Invoke-Obfuscation tool's COMPRESS technique. Upon execution, it checked for sandbox environments using WMI queries and process enumeration. If no sandbox was detected, it installed itself for persistence and communicated with C2 servers using a custom DNS tunneling protocol. The script tested which DNS query types could reach the C2 server and used the first successful type for all communications.",
        "Persistence": "RogueRobin established persistence by creating a file named %APPDATA%\\OneDrive.bat and a modified copy of itself as %APPDATA%\\OneDrive.ps1. It also created a shortcut in the Windows startup folder to execute the OneDrive.ps1 script at user login.",
        "Defense Evasion": "The payload used sandbox detection techniques and obfuscated the PowerShell script to evade defenses. It also leveraged the user's consent in Excel to bypass security prompts and execute the command prompt application.",
        "Command and Control": "The RogueRobin payload communicated with C2 servers using a custom DNS tunneling protocol. It tested various DNS query types to establish communication and used nslookup with crafted subdomains. The C2 domains spoofed legitimate technology providers, particularly security vendors, and resolved to IPs belonging to a service provider in China. The payload obtained a system-specific identifier from the C2 and transmitted system information using base64 encoding.",
        "Others": "DarkHydrus has been active since early 2016, leveraging weaponized Microsoft Office documents to deliver payloads like Meterpreter, Mimikatz, PowerShell Empire, Veil, and Cobalt Strike. The group's C2 infrastructure showed overlaps with another threat group, Copy Kittens, but no conclusive relational evidence was found. The domains used for C2 in this campaign attempted to spoof legitimate domains of technology providers, with an emphasis on security vendors. Palo Alto Networks customers are protected by malicious classification of the domains and endpoint protection from Traps. AutoFocus customers can learn more from the DarkHydrus tag."
    },
    "technique_label": true
}